define(["jquery","underscore","shared/collections/modelsCache","shared/views/base","collections/greenButtonConsumptions"],function(e,t,n,r,i){return r.extend({initialize:function(e){this.consumption=new i,this.consumption.on("sync",this.doRender,this)},render:function(e){return this.options=e||{},this.options.data=this.options.data||{last_day:moment().dayOfYear(),duration:6},this.options.data.user_id=n.currentUser,this.consumption.fetch({data:this.options.data}),this},doRender:function(){var t=e("<table/>");t.addClass("punchard");var n;$row=e("<tr/>");var r=0;for(var i=0;i<24;i++){var s=e("<th/>");s.html(i),$row.append(s)}t.append($row);var o=this;this.scores={stars:[],flags:[]},this.consumption.each(function(i){var s=i.get("date");if(moment(s).dayOfYear()>moment().dayOfYear())return;if(s!==n){if(r<-6)return;n=s,$row=e("<tr/>");var u=e("<td class='rowhead' colspan='24'/>");u.html(moment().add("days",r).format("MMM, ddd DD")),$row.append(u),t.append($row),$row=e("<tr/>"),t.append($row),r-=1}var u=e("<td/>");if(moment(s).dayOfYear()===moment().dayOfYear()&&i.get("hour")>=moment().hour())return $row.append(u);var a={1:"rgba(211, 220, 90, 0.2)",2:"rgba(180, 211, 79, 0.53)",3:"rgba(119, 146, 65, 0.7)"};u.css("background-color",a[i.get("fraction")]);var f=5+(i.get("consumption")-1)*6;u.css("font-size",f+"px"),i.get("consumption")==3&&i.get("fraction")==1&&(u.html('<i class="icon-flag"/>'),u.addClass("gray-hour"),u.css("font-size","10px"),o.scores.flags.push(i)),i.get("consumption")==3&&(i.get("fraction")==3||i.get("fraction")==2)&&(u.html('<i class="icon-star"/>'),u.addClass("green-hour"),u.css("font-size","10px"),o.scores.stars.push(i)),$row.append(u)}),this.$el.append(t),this.trigger("rendered")}})});