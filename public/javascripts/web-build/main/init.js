define("shared/views/base",["backbone"],function(e){return e.View.extend({getQueryParams:function(){var e=window.location.search.substring(1).split("&"),t={};for(var n in e){if(e[n]==="")continue;var r=e[n].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t},clean:function(){this.remove(),this.unbind()}})}),define("views/graphs/forecast",["jquery","underscore","shared/views/base"],function(e,t,n){return n.extend({initialize:function(e){},render:function(e){return this.options=e,this.options=[{hour:6,forecast:1},{hour:7,forecast:2},{hour:8,forecast:3},{hour:9,forecast:1},{hour:10,forecast:2},{hour:11,forecast:1},{hour:12,forecast:3}],this.colorMap={1:"#d3dc5a",2:"#b4d34f",3:"#779241"},this.doRender(),this},doRender:function(){this.$el.empty();var n=e("<table/>");n.addClass("forecast");var r=e("<tr/>"),i=e("<tr/>"),s=this;t.each(this.options,function(t){var n=e("<td/>");n.html(t.hour),r.append(n);var o=e("<td/>");o.css("background-color",s.colorMap[t.forecast]),i.append(o)}),n.append(r),n.append(i),this.$el.append(n)}})}),define("views/graphs/currentConsumption",["jquery","underscore","shared/views/base"],function(e,t,n){return n.extend({initialize:function(e){},render:function(e){return this.options=e,this.doRender(),this.$el.height(100),this},doRender:t.debounce(function(){this.$el.dxCircularGauge({geometry:{startAngle:180,endAngle:0},rangeContainer:{ranges:[{startValue:0,endValue:this.options.baseConsumption,color:"#b4d34f"},{startValue:this.options.baseConsumption,endValue:this.options.peakConsumption,color:"#d3dc5a"},{startValue:this.options.peakConsumption,endValue:1.2*Math.max(this.options.peakConsumption,this.options.currentConsumption),color:"#f1e064"}]},scale:{startValue:0,endValue:1.2*Math.max(this.options.peakConsumption,this.options.currentConsumption),majorTick:{showCalculatedTicks:!1,customTickValues:[0,this.options.baseConsumption,this.options.peakConsumption]}},value:this.options.currentConsumption})},100)})}),define("text!views/home/realTime.html",[],function(){return'<div class="row-fluid">\n  <div class="span8 mobile-span" id="current-consumption"></div>\n  <div class="span4 mobile-span">\n    <p>Current: <br> <%= currentConsumption %> kW</p>\n  </div>\n</div>'}),define("views/home/realTime",["jquery","underscore","shared/views/base","./../graphs/currentConsumption","text!./realTime.html"],function(e,t,n,r,i){return n.extend({initialize:function(e){this.currentConsumption=new r},render:function(e){return this.options=e,this.$el.html(t.template(i,this.options.currentConsumptionOptions)),this.currentConsumption.setElement(this.$("#current-consumption")).render(this.options.currentConsumptionOptions),this}})}),define("views/graphs/currentGreenGauge",["jquery","underscore","shared/views/base"],function(e,t,n){return n.extend({initialize:function(e){},render:function(e){return this.options=e,this.doRender(),this.$el.height(40),this.graphOptions={0:{color:"g",label:""},1:{color:"#d3dc5a",label:"low"},2:{color:"#b4d34f",label:"med."},3:{color:"#779241",label:"high"}},this},doRender:t.debounce(function(){var e=this;this.$el.dxLinearGauge({rangeContainer:{ranges:[{startValue:0,endValue:1,color:"#d3dc5a"},{startValue:1,endValue:2,color:"#b4d34f"},{startValue:2,endValue:3,color:"#779241"}]},scale:{startValue:0,endValue:3,majorTick:{tickInterval:1},label:{customizeText:function(t){return e.graphOptions[t.valueText].label}}},valueIndicator:{type:"circle"},value:this.options.value-.5})},100)})}),define("views/graphs/scores",["jquery","underscore","shared/views/base"],function(e,t,n){return n.extend({initialize:function(e){},render:function(e){return this.options=e,this.doRender(),this.$el.height(200),this},doRender:t.debounce(function(){this.$el.dxChart({dataSource:this.options,commonSeriesSettings:{argumentField:"month",type:"bar"},series:[{valueField:"grayHours",name:"CO2 Hours",color:"#C9C6B6"},{valueField:"greenHours",name:"Green Hours",color:"#779241"}],legend:{verticalAlignment:"center",horizontalAlignment:"center"}})},100)})}),define("text!views/home/home.html",[],function(){return'<div class="row-fluid section" data-target="/breakdown">\n  <div class="in-container">\n    <h4>Current consumption</h4>\n    <div id="real-time"></div>\n  </div>\n</div>\n\n<div class="row-fluid section" data-target="/breakdown">\n  <div class="in-container">\n    <h4>Current Green Production</h4>\n    <div class="row-fluid">\n      <div id="current-green-gauge"></div>\n    </div>\n  </div>\n</div>\n\n<div class="row-fluid section">\n  <div class="in-container">\n\n    <h4>Forecast\n      <small>Next 6 hours</small>\n    </h4>\n    <div id="forecast" class="center"></div>\n  </div>\n</div>\n\n\n\n\n<div class="row-fluid section" data-target="/history">\n  <div class="in-container">\n    <h4>Goals\n      <small>March</small>\n    </h4>\n    <div class="row-fluid">\n      <p class="span3 mobile-span legend">Green Hours</p>\n      <div class="span9 mobile-span">\n        <div class="progress">\n          <div class="bar bar-green-hour" style="width: 30%;"></div>\n          <div class="current-date-marker">Today</div>\n        </div>\n      </div>\n    </div>\n\n    <div class="row-fluid">\n      <p class="span3 mobile-span legend">CO2 Hours</p>\n\n      <div class="span9 mobile-span">\n        <div class="progress">\n          <div class="bar bar-gray-hour" style="width: 60%;"></div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n</div>\n\n<div class="row-fluid section">\n  <div class="in-container">\n    <h4>Advice</h4>\n\n    <p>Get more green hours </p>\n\n  </div>\n</div>\n\n\n<div class="row-fluid section">\n  <div class="in-container">\n\n    <h4>Scores\n      <small>Past 6 months</small>\n    </h4>\n    <div id="scores"></div>\n  </div>\n</div>\n\n'}),define("views/home/home",["backbone","jquery","underscore","shared/views/base","./../graphs/forecast","./realTime","./../graphs/currentGreenGauge","./../graphs/scores","text!./home.html"],function(e,t,n,r,i,s,o,u,a){return r.extend({initialize:function(e){this.forecast=new i,this.realTime=new s,this.currentGreenGauge=new o,this.scores=new u},events:{"click .section":"onSectionClicked"},render:function(){this.$el.html(a);var e={currentConsumptionOptions:{baseConsumption:13,currentConsumption:23,peakConsumption:34},currentGreenGauge:{value:1}},t=[{month:"Oct",greenHours:165,grayHours:-24},{month:"Nov",greenHours:35,grayHours:-34},{month:"Dec",greenHours:234,grayHours:-54},{month:"Jan",greenHours:195,grayHours:-12},{month:"Fev",greenHours:134,grayHours:-14},{month:"Mars",greenHours:10,grayHours:-5}];return this.forecast.setElement(this.$("#forecast")).render(),this.realTime.setElement(this.$("#real-time")).render(e),this.currentGreenGauge.setElement(this.$("#current-green-gauge")).render(e.currentGreenGauge),this.scores.setElement(this.$("#scores")).render(t),this},onSectionClicked:function(n){var r=t(n.currentTarget).attr("data-target");e.history.navigate(r,!0)}})}),define("views/graphs/realTimeBreakdown",["jquery","underscore","shared/views/base"],function(e,t,n){return n.extend({initialize:function(e){},render:function(e){return this.options=e,this.doRender(),this.$el.height(300),this.settings={Solar:{color:"#779241"},Wind:{color:"#d3dc5a"},"Other renewable":{color:"#b4d34f"},"Non renewable":{color:"#C9C6B6"}},this},doRender:t.debounce(function(){var e=this;this.$el.dxPieChart({legend:{verticalAlignment:"bottom",horizontalAlignment:"center"},dataSource:this.options,series:[{argumentField:"name",valueField:"value"}],title:"Real time production",customizePoint:function(t){return{color:e.settings[t.argument].color}},margin:{left:0}})},100)})}),define("text!views/home/breakdown.html",[],function(){return""}),define("views/home/breakdown",["jquery","underscore","shared/views/base","./../graphs/realTimeBreakdown","text!./breakdown.html"],function(e,t,n,r,i){return n.extend({initialize:function(e){this.breakdown=new r},render:function(){this.$el.html(i);var e=[{name:"Solar",value:1234},{name:"Wind",value:3545},{name:"Other renewable",value:125},{name:"Non renewable",value:5234}];return this.breakdown.setElement(this.$el).render(e),this}})}),define("models/greenButtonConsumption",["backbone"],function(e){return e.Model.extend({urlRoot:"/api/green_button"})}),define("collections/greenButtonConsumptions",["underscore","backbone","models/greenButtonConsumption"],function(e,t,n){var r=t.Collection.extend({model:n,url:"/api/green_button"});return r}),define("views/graphs/greenButtonConsumption",["jquery","underscore","shared/views/base","collections/greenButtonConsumptions"],function(e,t,n,r){return n.extend({initialize:function(e){this.consumption=new r,this.consumption.on("sync",this.doRender,this)},render:function(e){return this.options=e,this.$el.width(1e3),this.consumption.fetch(),this},doRender:function(){var t=e("<table/>");t.addClass("punchard");var n;$row=e("<tr/>");for(var r=0;r<24;r++){var i=e("<th/>");i.html(r),$row.append(i)}t.append($row),this.consumption.each(function(r){var i=r.get("date");i!==n&&(n=i,$row=e("<tr/>"),t.append($row));var s=e("<td/>"),o={1:"#ebf1df",2:"#c4d69e",3:"#779241"};s.css("background-color",o[r.get("fraction")]);var u=5+(r.get("consumption")-1)*6;s.html("&#9679;"),s.css("font-size",u+"px"),r.get("consumption")==3&&r.get("fraction")==1&&s.addClass("gray-hour"),r.get("consumption")==3&&r.get("fraction")==3&&s.addClass("green-hour"),$row.append(s)}),this.$el.append(t)}})}),define("text!views/home/history.html",[],function(){return'<div class="history-container">\n  <p>Here is your consumption over the last 31 days.</p>\n\n  <p>Tips: Try to offset your big peaks of consumption in order to benefit for the green hours !</p>\n\n  <p>Here are your results for the last 31 days: </p>\n  <dl>\n    <dt>Green hours</dt>\n    <dd>5</dd>\n    <dt>CO2 hours</dt>\n    <dd>6</dd>\n  </dl>\n\n  <div id="full-history"></div>\n</div>\n'}),define("views/home/history",["jquery","underscore","shared/views/base","./../graphs/greenButtonConsumption","text!./history.html"],function(e,t,n,r,i){return n.extend({initialize:function(e){this.consumption=new r},render:function(){return this.$el.html(i),this.consumption.setElement(this.$("#full-history")).render(),this}})}),define("text!views/navigation/navigation.html",[],function(){return'<span class="previous-page">\n      <i class="icon-chevron-left"></i> Back\n    </span>\n<span class="title"><%= title %></span>\n'}),define("views/navigation/navigation",["backbone","jquery","underscore","shared/views/base","text!./navigation.html"],function(e,t,n,r,i){return r.extend({initialize:function(e){},render:function(e){return this.$el.html(n.template(i,e)),e.hideBack&&this.$(".previous-page").hide(),this},events:{"click .previous-page":"onPreviousPageClick"},onPreviousPageClick:function(){e.history.navigate("/",!0)}})}),define("router",["jquery","underscore","backbone","views/home/home","views/home/breakdown","views/home/history","views/navigation/navigation"],function(e,t,n,r,i,s,o){return n.Router.extend({routes:{"":"start",breakdown:"realTimeBreakdown",history:"history","*catchAll":"notFound"},initialize:function(e){this.$leftPane=e.find("#left-pane-inner"),this.$navBar=e.find("#navigation"),this.views={home:{view:new r,rendered:!1},breakdown:{view:new i,rendered:!1},history:{view:new s,rendered:!1},navigation:{view:new o,rendered:!1}}},renderView:function(n,r,i,s){n.find("#pane-contents").detach();if(!r)return;var o=this.views[r];if(!o)throw new Error("View not found "+r);t.isMobile()&&window.scrollTo(0,1);if(s||!o.rendered){var u=e('<div id="pane-contents" class="paneContents-'+r+'"></div>');o.view.setElement(u).render(i)}n.append(o.view.$el),o.rendered=!0,this.views[r]=o},start:function(){this.renderView(this.$leftPane,"home",{},!0),this.renderView(this.$navBar,"navigation",{title:"Home",hideBack:!0},!0)},notFound:function(){this.start()},realTimeBreakdown:function(){this.renderView(this.$leftPane,"breakdown",{},!0),this.renderView(this.$navBar,"navigation",{title:"Real Time"},!0)},history:function(){this.renderView(this.$leftPane,"history",{},!0),this.renderView(this.$navBar,"navigation",{title:"History"},!0)}})}),define("text!layout.html",[],function(){return'<div id="nav_bar"></div>\n<div id="body" class="container body">\n  <section id="navigation"></section>\n\n  <div class="row containerRow">\n    <section id="left-pane" class="span8 scrollable">\n      <div id="left-pane-inner"></div>\n    </section>\n    <section id="right-pane" class="span4">\n      <div id="right-pane-inner" class="scrollable"></div>\n    </section>\n\n  </div>\n</div>\n\n<div id="footer" class="hidden-phone">\n  <span class="copyright">© 2014  </span>\n</div>'}),define("layout",["jquery","underscore","shared/views/base","text!./layout.html"],function(e,t,n,r){var i=n.extend({el:"body",initialize:function(){},events:{"touchmove .scrollable":"onScrollableTouch"},render:function(){return this.$el.html(r),this},onScrollableTouch:function(e){e.stopPropagation()}});return i}),define("init",["underscore","jquery","backbone","./router","./layout"],function(e,t,n,r,i){var s=t("body");setTimeout(function(){if(!e.isMobile())return;var n=1.2*t(document).height();s.css("min-height",n+"px"),window.scrollTo(0,1)},20),(new i).render();var o=new r(s);n.history.start({pushState:!0})});