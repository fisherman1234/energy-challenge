jQuery(function(e){e.fn.eventCalendar=function(t){function n(e,t){return e.date.toLowerCase()>t.date.toLowerCase()?1:-1}function r(t,n,r){var i=e("<div class='eventsCalendar-slider'></div>"),o=e("<div class='eventsCalendar-monthWrap'></div>"),u=e("<div class='eventsCalendar-currentTitle'><a  class='monthTitle'></a></div>"),a=e("<a class='arrow prev'><span>"+l.txt_prev+"</span></a><a  class='arrow next'><span>"+l.txt_next+"</span></a>");$eventsCalendarDaysList=e("<ul class='eventsCalendar-daysList'></ul>"),y=new Date,c.wrap.find(".eventsCalendar-slider").size()?c.wrap.find(".eventsCalendar-slider").append(o):(c.wrap.prepend(i),i.append(o)),c.wrap.find(".eventsCalendar-monthWrap.currentMonth").removeClass("currentMonth").addClass("oldMonth"),o.addClass("currentMonth").append(u,$eventsCalendarDaysList);if(t==="current")day=y.getDate(),i.append(a);else{y=new Date(c.wrap.attr("data-current-year"),c.wrap.attr("data-current-month"),1,0,0,0),day=0,moveOfMonth=1,t==="prev"&&(moveOfMonth=-1),y.setMonth(y.getMonth()+moveOfMonth);var f=new Date;y.getMonth()===f.getMonth()&&(day=f.getDate())}var n=y.getFullYear(),h=(new Date).getFullYear(),r=y.getMonth(),p=r+1;t!="current"&&s(l.eventsLimit,n,r,!1,t),c.wrap.attr("data-current-month",r).attr("data-current-year",n),u.find(".monthTitle").html(l.monthNames[r]+" "+n);var d=32-(new Date(n,r,32)).getDate(),v=[];if(l.showDayAsWeeks){$eventsCalendarDaysList.addClass("showAsWeek");if(l.showDayNameInCalendar){$eventsCalendarDaysList.addClass("showDayNames");var m=0;l.startWeekOnMonday&&(m=1);for(;m<7;m++)v.push('<li class="eventsCalendar-day-header">'+l.dayNamesShort[m]+"</li>"),m===6&&l.startWeekOnMonday&&v.push('<li class="eventsCalendar-day-header">'+l.dayNamesShort[0]+"</li>")}dt=new Date(n,r,1);var g=dt.getDay();l.startWeekOnMonday&&(g=dt.getDay()-1),g<0&&(g=6);var y=new Date(n,r,d);y.setDate(y.getDate()-d);var b=y.getMonth(),w=y.getYear(),E=32-(new Date(w,b,32)).getDate();for(m=g;m>0;m--){var S=E-(m-1);v.push('<li id="dayList_prev_'+S+'" class="eventsCalendar-day faded"><a>'+S+"</a></li>")}}for(dayCount=1;dayCount<=d;dayCount++){var x="";day>0&&dayCount===day&&n===h&&(x="today"),v.push('<li id="dayList_'+dayCount+'" rel="'+dayCount+'" class="eventsCalendar-day '+x+'"><a>'+dayCount+"</a></li>")}lastDay=new Date(n,r,d);var T=lastDay.getDay(),N;l.startWeekOnMonday?T==0?N=0:N=7-T:T==7?N=0:N=6-T;for(m=1;m<N+1;m++)v.push('<li id="dayList_next_'+m+'" class="eventsCalendar-day faded"><a>'+m+"</a></li>");$eventsCalendarDaysList.append(v.join("")),i.css("height",o.height()+"px")}function i(e){var t=e.length,n=e.charAt(t-1),r;return t===2&&e.charAt(0)==="1"?r="th":n==="1"?r="st":n==="2"?r="nd":n==="3"?r="rd":r="th",e+r}function s(t,n,r,i,s){var t=t||0,n=n||"",i=i||"";if(typeof r!="undefined")var r=r;else var r="";c.wrap.find(".eventsCalendar-loading").fadeIn(),l.jsonData?(l.cacheJson=!0,c.eventsJson=l.jsonData,o(c.eventsJson,t,n,r,i,s)):!l.cacheJson||!s?e.getJSON(l.eventsjson+"?limit="+t+"&year="+n+"&month="+r+"&day="+i,function(e){c.eventsJson=e,o(c.eventsJson,t,n,r,i,s)}).error(function(){a("error getting json: ")}):o(c.eventsJson,t,n,r,i,s),i>""&&(c.wrap.find(".current").removeClass("current"),c.wrap.find("#dayList_"+i).addClass("current"))}function o(t,r,s,o,u,a){directionLeftMove="-="+c.directionLeftMove,eventContentHeight="auto",subtitle=c.wrap.find(".eventsCalendar-list-wrap .eventsCalendar-subtitle");if(!a)subtitle.html(l.txt_NextEvents),eventContentHeight="auto",directionLeftMove="-=0";else{u!=""?subtitle.html(l.txt_SpecificEvents_prev+l.monthNames[o]+" "+i(u)+" "+l.txt_SpecificEvents_after):subtitle.html(l.txt_SpecificEvents_prev+l.monthNames[o]+" "+l.txt_SpecificEvents_after);if(a==="prev")directionLeftMove="+="+c.directionLeftMove;else if(a==="day"||a==="month")directionLeftMove="+=0",eventContentHeight=0}c.wrap.find(".eventsCalendar-list").animate({opacity:l.moveOpacity,left:directionLeftMove,height:eventContentHeight},l.moveSpeed,function(){c.wrap.find(".eventsCalendar-list").css({left:0,height:"auto"}).hide();var i=[];t=e(t).sort(n);if(t.length){var a="";l.showDescription||(a="hidden");var f="_self";l.openEventInNewWindow&&(f="_target");var h=0;e.each(t,function(e,t){if(l.jsonDateFormat=="human")var n=t.date.split(" "),p=n[0].split("-"),d=n[1].split(":"),v=p[0],m=parseInt(p[1])-1,g=parseInt(p[2]),y=parseInt(m)+1,b=d[0],w=d[1],E=d[2],p=new Date(v,m,g,b,w,E);else var p=new Date(parseInt(t.date)),v=p.getFullYear(),m=p.getMonth(),g=p.getDate(),y=m+1,b=p.getHours(),w=p.getMinutes();parseInt(w)<=9&&(w="0"+parseInt(w));if(r===0||r>h)if((o===!1||o==m)&&(u==""||u==g)&&(s==""||s==v)&&!(o===!1&&p<new Date)){eventStringDate=g+"/"+y+"/"+v;if(t.url)var S='<a href="'+t.url+'" target="'+f+'" class="eventTitle">'+t.title+"</a>";else var S='<span class="eventTitle">'+t.title+"</span>";i.push('<li id="'+e+'" class="'+t.type+'"><time datetime="'+p+'"><em>'+eventStringDate+"</em><small>"+b+":"+w+"</small></time>"+S+'<p class="eventDesc '+a+'">'+t.description+"</p></li>"),h++}v==c.wrap.attr("data-current-year")&&m==c.wrap.attr("data-current-month")&&c.wrap.find(".currentMonth .eventsCalendar-daysList #dayList_"+parseInt(g)).addClass("dayWithEvents")})}i.length||i.push('<li class="eventsCalendar-noEvents"><p>'+l.txt_noEvents+"</p></li>"),c.wrap.find(".eventsCalendar-loading").hide(),c.wrap.find(".eventsCalendar-list").html(i.join("")),c.wrap.find(".eventsCalendar-list").animate({opacity:1,height:"toggle"},l.moveSpeed)}),f()}function u(){c.wrap.find(".arrow").click(function(t){t.preventDefault();if(e(this).hasClass("next")){r("next");var n="-="+c.directionLeftMove}else{r("prev");var n="+="+c.directionLeftMove}c.wrap.find(".eventsCalendar-monthWrap.oldMonth").animate({opacity:l.moveOpacity,left:n},l.moveSpeed,function(){c.wrap.find(".eventsCalendar-monthWrap.oldMonth").remove()})})}function a(e){c.wrap.find(".eventsCalendar-list-wrap").html("<span class='eventsCalendar-loading error'>"+e+" "+l.eventsjson+"</span>")}function f(){c.directionLeftMove=c.wrap.width(),c.wrap.find(".eventsCalendar-monthWrap").width(c.wrap.width()+"px"),c.wrap.find(".eventsCalendar-list-wrap").width(c.wrap.width()+"px")}var l=e.extend({},e.fn.eventCalendar.defaults,t),c={wrap:"",directionLeftMove:"300",eventsJson:{}};this.each(function(){c.wrap=e(this),c.wrap.addClass("eventCalendar-wrap").append("<div class='eventsCalendar-list-wrap'><p class='eventsCalendar-subtitle'></p><span class='eventsCalendar-loading'>loading...</span><div class='eventsCalendar-list-content'><ul class='eventsCalendar-list'></ul></div></div>"),l.eventsScrollable&&c.wrap.find(".eventsCalendar-list-content").addClass("scrollable"),f(),e(window).resize(function(){f()}),r("current"),s(l.eventsLimit,!1,!1,!1,!1),u(),c.wrap.on("click",".eventsCalendar-day a",function(t){t.preventDefault();var n=c.wrap.attr("data-current-year"),r=c.wrap.attr("data-current-month"),i=e(this).parent().attr("rel");s(!1,n,r,i,"day")}),c.wrap.on("click",".monthTitle",function(e){e.preventDefault();var t=c.wrap.attr("data-current-year"),n=c.wrap.attr("data-current-month");s(l.eventsLimit,t,n,!1,"month")})}),c.wrap.find(".eventsCalendar-list").on("click",".eventTitle",function(t){if(!l.showDescription){t.preventDefault();var n=e(this).parent().find(".eventDesc");if(!n.find("a").size()){var r=e(this).attr("href"),i=e(this).attr("target");n.append('<a href="'+r+'" target="'+i+'" class="bt">'+l.txt_GoToEventUrl+"</a>")}n.is(":visible")?n.slideUp():(l.onlyOneDescription&&c.wrap.find(".eventDesc").slideUp(),n.slideDown())}})},e.fn.eventCalendar.defaults={eventsjson:"js/events.json",eventsLimit:4,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],txt_noEvents:"There are no events in this period",txt_SpecificEvents_prev:"",txt_SpecificEvents_after:"events:",txt_next:"next",txt_prev:"prev",txt_NextEvents:"Next events:",txt_GoToEventUrl:"See the event",showDayAsWeeks:!0,startWeekOnMonday:!0,showDayNameInCalendar:!0,showDescription:!1,onlyOneDescription:!0,openEventInNewWindow:!1,eventsScrollable:!1,jsonDateFormat:"timestamp",moveSpeed:500,moveOpacity:.15,jsonData:"",cacheJson:!0}});