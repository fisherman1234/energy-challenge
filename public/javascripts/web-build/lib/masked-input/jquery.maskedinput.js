/*
	Masked Input plugin for jQuery
	Copyright (c) 2007-2013 Josh Bush (digitalbush.com)
	Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license)
	Version: 1.3.1
*/

(function(e){function t(){var e=document.createElement("input"),t="onpaste";return e.setAttribute(t,""),typeof e[t]=="function"?"paste":"input"}var n=t()+".mask",r=navigator.userAgent,i=/iphone/i.test(r),s=/android/i.test(r),o;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function(e,t){var n;if(this.length===0||this.is(":hidden"))return;return typeof e=="number"?(t=typeof t=="number"?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&(n=this.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,r){var u,a,f,l,c,h;return!t&&this.length>0?(u=e(this[0]),u.data(e.mask.dataName)()):(r=e.extend({placeholder:e.mask.placeholder,completed:null},r),a=e.mask.definitions,f=[],l=h=t.length,c=null,e.each(t.split(""),function(e,t){t=="?"?(h--,l=e):a[t]?(f.push(new RegExp(a[t])),c===null&&(c=f.length-1)):f.push(null)}),this.trigger("unmask").each(function(){function u(e){while(++e<h&&!f[e]);return e}function p(e){while(--e>=0&&!f[e]);return e}function d(e,t){var n,i;if(e<0)return;for(n=e,i=u(t);n<h;n++)if(f[n]){if(!(i<h&&f[n].test(S[i])))break;S[n]=S[i],S[i]=r.placeholder,i=u(i)}b(),E.caret(Math.max(c,e))}function v(e){var t,n,i,s;for(t=e,n=r.placeholder;t<h;t++)if(f[t]){i=u(t),s=S[t],S[t]=n;if(!(i<h&&f[i].test(s)))break;n=s}}function m(e){var t=e.which,n,r,s;t===8||t===46||i&&t===127?(n=E.caret(),r=n.begin,s=n.end,s-r===0&&(r=t!==46?p(r):s=u(r-1),s=t===46?u(s):s),y(r,s),d(r,s-1),e.preventDefault()):t==27&&(E.val(x),E.caret(0,w()),e.preventDefault())}function g(t){var n=t.which,i=E.caret(),o,a,l;if(t.ctrlKey||t.altKey||t.metaKey||n<32)return;n&&(i.end-i.begin!==0&&(y(i.begin,i.end),d(i.begin,i.end-1)),o=u(i.begin-1),o<h&&(a=String.fromCharCode(n),f[o].test(a)&&(v(o),S[o]=a,b(),l=u(o),s?setTimeout(e.proxy(e.fn.caret,E,l),0):E.caret(l),r.completed&&l>=h&&r.completed.call(E))),t.preventDefault())}function y(e,t){var n;for(n=e;n<t&&n<h;n++)f[n]&&(S[n]=r.placeholder)}function b(){E.val(S.join(""))}function w(e){var t=E.val(),n=-1,i,s;for(i=0,pos=0;i<h;i++)if(f[i]){S[i]=r.placeholder;while(pos++<t.length){s=t.charAt(pos-1);if(f[i].test(s)){S[i]=s,n=i;break}}if(pos>t.length)break}else S[i]===t.charAt(pos)&&i!==l&&(pos++,n=i);return e?b():n+1<l?(E.val(""),y(0,h)):(b(),E.val(E.val().substring(0,n+1))),l?i:c}var E=e(this),S=e.map(t.split(""),function(e,t){if(e!="?")return a[e]?r.placeholder:e}),x=E.val();E.data(e.mask.dataName,function(){return e.map(S,function(e,t){return f[t]&&e!=r.placeholder?e:null}).join("")}),E.attr("readonly")||E.one("unmask",function(){E.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){clearTimeout(o);var e,n;x=E.val(),e=w(),o=setTimeout(function(){b(),e==t.length?E.caret(0,e):E.caret(e)},10)}).bind("blur.mask",function(){w(),E.val()!=x&&E.change()}).bind("keydown.mask",m).bind("keypress.mask",g).bind(n,function(){setTimeout(function(){var e=w(!0);E.caret(e),r.completed&&e==E.val().length&&r.completed.call(E)},0)}),w()}))}})})(jQuery);